{
  "nodes": {
    "start": {
      "id": "start",
      "speaker": "Pixel",
      "text": "Level 4 - LOOPS! The secret to not repeating yourself a million times! ðŸ”„",
      "followUp": "Imagine typing 'spawn enemy' 100 times... Nah! Let's make TypeScript do the repetitive work in Strata!",
      "options": [
        {
          "text": "Show me the loop magic!",
          "next": "whileLoop"
        },
        {
          "text": "Why are loops important?",
          "next": "loopImportance"
        }
      ]
    },
    "loopImportance": {
      "id": "loopImportance",
      "speaker": "Pixel",
      "text": "Games are ALL about loops! The game loop runs 60 times per second, checking inputs, updating positions, drawing graphics!",
      "followUp": "Without loops, games couldn't exist! Let's master them!",
      "options": [
        {
          "text": "I'm convinced! Teach me!",
          "next": "whileLoop"
        }
      ]
    },
    "whileLoop": {
      "id": "whileLoop",
      "speaker": "Pixel",
      "text": "The 'while' loop keeps running as long as something is true - like 'while game is running'!",
      "codeExample": "let health = 100;\n\nwhile (health > 0) {\n    console.log(`Still alive! HP: ${health}`);\n    health = health - 20;\n}\n    \nconsole.log('Game Over!');",
      "followUp": "It checks the condition, runs the code, then checks again. Repeat until false!",
      "options": [
        {
          "text": "What if it never stops?",
          "next": "infiniteLoop"
        },
        {
          "text": "Show me more examples!",
          "next": "whileExamples"
        }
      ]
    },
    "infiniteLoop": {
      "id": "infiniteLoop",
      "speaker": "Pixel",
      "text": "Ah, the dreaded infinite loop! If the condition never becomes false, it runs FOREVER!",
      "codeExample": "// DON'T RUN THIS!\n// while (true) {\n//     console.log('This never stops!');\n// }\n    \n// Better - with an exit condition:\nlet isRunning = true;\nlet turns = 0;\n\nwhile (isRunning) {\n    turns += 1;\n    console.log(`Turn ${turns}`);\n    if (turns >= 5) {\n        isRunning = false;\n    }\n}",
      "followUp": "Always make sure your loop has a way to end, or your game will freeze!",
      "options": [
        {
          "text": "How do I control loops better?",
          "next": "breakContinue"
        }
      ]
    },
    "whileExamples": {
      "id": "whileExamples",
      "speaker": "Pixel",
      "text": "Here's a mini game loop - collecting coins until you have enough!",
      "codeExample": "let coins = 0;\nlet goal = 50;\n\nwhile (coins < goal) {\n    console.log(`Coins: ${coins}/${goal}`);\n    let found = 10;  // Found 10 coins!\n    coins += found;\n    console.log(`Found ${found} coins!`);\n}\n    \nconsole.log(`Success! You collected ${coins} coins!`);",
      "followUp": "Perfect for any 'keep doing until' situation in games!",
      "options": [
        {
          "text": "What about counting specific times?",
          "next": "forLoop"
        }
      ]
    },
    "breakContinue": {
      "id": "breakContinue",
      "speaker": "Pixel",
      "text": "'break' and 'continue' give you superpowers over loops!",
      "codeExample": "// break - escape the loop immediately!\nlet lives = 3;\nwhile (true) {\n    console.log(`Lives: ${lives}`);\n    lives -= 1;\n    if (lives === 0) {\n        console.log('No lives left!');\n        break;  // Exit loop!\n    }\n}\n        \n// continue - skip to next iteration\nfor (let i = 1; i <= 5; i++) {\n    if (i === 3) {\n        continue;  // Skip 3!\n    }\n    console.log(i);  // Prints: 1, 2, 4, 5\n}",
      "followUp": "'break' is the emergency exit, 'continue' is the skip button!",
      "options": [
        {
          "text": "Show me for loops!",
          "next": "forLoop"
        }
      ]
    },
    "forLoop": {
      "id": "forLoop",
      "speaker": "Pixel",
      "text": "The 'for' loop is perfect when you know how many times to repeat - like spawning 5 enemies!",
      "codeExample": "// Spawn exactly 5 enemies\nfor (let i = 0; i < 5; i++) {\n    console.log(`Spawning enemy #${i + 1}`);\n}",
      "followUp": "In TypeScript, the common for-loop has three parts: starting point, condition, and update!",
      "options": [
        {
          "text": "Explain those three parts!",
          "next": "forParts"
        },
        {
          "text": "Can I loop through other things?",
          "next": "forOfLoop"
        }
      ]
    },
    "forParts": {
      "id": "forParts",
      "speaker": "Pixel",
      "text": "Sure! for (let i = 0; i < 5; i++) means: Start i at 0, keep going while i is less than 5, and add 1 to i every time!",
      "codeExample": "// let i = 0  -> Starting point\n// i < 5      -> Keep going condition\n// i++        -> Add 1 after each time\n\nfor (let i = 0; i < 10; i += 2) {\n    console.log(i); // Prints: 0, 2, 4, 6, 8\n}",
      "followUp": "It's super flexible - you can count up, down, or skip numbers!",
      "options": [
        {
          "text": "What about looping through collections?",
          "next": "forOfLoop"
        }
      ]
    },
    "forOfLoop": {
      "id": "forOfLoop",
      "speaker": "Pixel",
      "text": "If you just want to go through a collection of items, the 'for...of' loop is even easier!",
      "codeExample": "// Loop through an array (collection)\nlet inventory = ['sword', 'shield', 'potion'];\nfor (let item of inventory) {\n    console.log(`You have: ${item}`);\n}\n\n// Loop through a string\nlet word = 'PIXEL';\nfor (let letter of word) {\n    console.log(`Give me a ${letter}!`);\n}",
      "followUp": "'for...of' is like saying 'for each item in the collection'!",
      "options": [
        {
          "text": "Can I nest loops?",
          "next": "nestedLoops"
        },
        {
          "text": "Show me a game example!",
          "next": "gameExample"
        }
      ]
    },
    "nestedLoops": {
      "id": "nestedLoops",
      "speaker": "Pixel",
      "text": "Nested loops are loops inside loops - perfect for grids, like game boards!",
      "codeExample": "// Create a 3x3 grid\nfor (let row = 0; row < 3; row++) {\n    let rowText = '';\n    for (let col = 0; col < 3; col++) {\n        rowText += `(${row},${col}) `;\n    }\n    console.log(rowText);\n}\n    \n// Output:\n// (0,0) (0,1) (0,2) \n// (1,0) (1,1) (1,2) \n// (2,0) (2,1) (2,2) ",
      "followUp": "The inner loop runs completely for each iteration of the outer loop!",
      "options": [
        {
          "text": "That's perfect for tile-based games!",
          "next": "tileExample"
        }
      ]
    },
    "tileExample": {
      "id": "tileExample",
      "speaker": "Pixel",
      "text": "Exactly! Here's how you'd generate a game map!",
      "codeExample": "// Simple map generation\nlet width = 5;\nlet height = 3;\nlet tiles = ['ðŸŒ²', 'ðŸŒ³', 'â¬œ'];\n\nfor (let y = 0; y < height; y++) {\n    let row = '';\n    for (let x = 0; x < width; x++) {\n        let randomTile = tiles[Math.floor(Math.random() * tiles.length)];\n        row += randomTile;\n    }\n    console.log(row);\n}\n    \n// Creates random forest/grass map!",
      "followUp": "Nested loops are the foundation of 2D game worlds in Strata!",
      "options": [
        {
          "text": "Show me more game uses!",
          "next": "gameExample"
        }
      ]
    },
    "gameExample": {
      "id": "gameExample",
      "speaker": "Pixel",
      "text": "Let's build a complete battle system with loops!",
      "codeExample": "// Turn-based combat\nlet playerHp = 100;\nlet enemyHp = 150;\nlet turn = 0;\n\nwhile (playerHp > 0 && enemyHp > 0) {\n    turn++;\n    console.log(`\\n--- Turn ${turn} ---`);\n    \n    // Player attacks\n    let damage = 25;\n    enemyHp -= damage;\n    console.log(`You deal ${damage} damage!`);\n    \n    if (enemyHp <= 0) {\n        console.log('Victory!');\n        break;\n    }\n        \n    // Enemy attacks\n    let enemyDamage = 15;\n    playerHp -= enemyDamage;\n    console.log(`Enemy deals ${enemyDamage} damage!`);\n    \n    console.log(`Your HP: ${playerHp} | Enemy HP: ${enemyHp}`);\n}\n\nif (playerHp <= 0) {\n    console.log('Defeat...');\n}",
      "followUp": "See how the loop handles the entire battle? That's the power of loops!",
      "options": [
        {
          "text": "Let me practice!",
          "next": "practiceChallenge"
        }
      ]
    },
    "practiceChallenge": {
      "id": "practiceChallenge",
      "speaker": "Pixel",
      "text": "Challenge time! Create a countdown timer for a bomb defusal mini-game!",
      "followUp": "Count from 10 down to 1. If you get lucky, the bomb is defused early!",
      "codeExample": "console.log('Defusing bomb...');\nlet defused = false;\n\nfor (let seconds = 10; seconds > 0; seconds--) {\n    console.log(`${seconds} seconds left!`);\n    \n    // 30% chance to defuse each second\n    if (Math.random() < 0.3) {\n        console.log('ðŸ’£ BOMB DEFUSED! ðŸŽ‰');\n        defused = true;\n        break;\n    }\n}\n\nif (!defused) {\n    console.log('ðŸ’¥ BOOM! ðŸ’¥');\n}",
      "options": [
        {
          "text": "I understand loops now!",
          "next": "lessonComplete"
        }
      ]
    },
    "lessonComplete": {
      "id": "lessonComplete",
      "speaker": "Pixel",
      "text": "ðŸŽŠ LEVEL 4 COMPLETE! You've mastered the art of repetition! ðŸ”",
      "followUp": "Loops are the heartbeat of every game - now you can make things happen again and again!",
      "action": "completeLesson",
      "actionParams": { "lesson": 4, "nextLesson": 5 },
      "options": [
        {
          "text": "On to Lesson 5 - Arrays & Collections!",
          "action": "loadLesson",
          "actionParams": { "lesson": 5 }
        },
        {
          "text": "I want to start building games!",
          "action": "startGameMode"
        },
        {
          "text": "Back to lesson menu",
          "action": "openLessons"
        }
      ]
    }
  },
  "startNode": "start"
}
